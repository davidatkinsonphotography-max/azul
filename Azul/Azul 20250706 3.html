<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Azul Scoring App</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: sans-serif;
    }
    #game {
      position: relative;
      width: 1496px;
      height: 826px;
      background: url('background.jpg') no-repeat center center;
      background-size: cover;
    }
    #score {
      position: absolute;
      left: 165px;
      top: 187px;
      transform: translate(-50%, -50%);
      font-size: 90px;
      color: white;
      text-shadow: 0 0 3px black, 0 0 5px black;
    }
    .penalty {
      position: absolute;
      width: 38px;
      height: 61px;
      cursor: pointer;
    }
    #end-round {
      position: absolute;
      left: 80px;
      top: 350px;
      width: 180px;
      height: 64px;
      cursor: pointer;
    }
.player-tile,
.wall-tile {
  box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.7);
  border-radius: 8px;
}
    .player-tile {
      position: absolute;
      width: 115px;
      height: 115px;
      cursor: pointer;
    }
.wall-tile {
  position: absolute;
  width: 115px;
  height: 115px;
}
    #popup {
      position: absolute;
      width: 320px;
      background: rgba(255,255,255,0.95);
      border: none;
      border-radius: 12px;
      padding: 10px;
      display: none;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      z-index: 999;
    }
    .tile-option {
      width: 48px;
      height: 48px;
      cursor: pointer;
  box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.4);
  border-radius: 4px;
}
    }

.player-tile.has-tile,
.wall-tile.has-tile {
  box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.7);
  border-radius: 6px;
}

  .fly-left {
    animation: flyLeft 0.6s forwards;
  }

  @keyframes flyLeft {
    0% {
      opacity: 1;
      transform: rotate(0deg) translateX(0px);
    }
    100% {
      opacity: 0;
      transform: rotate(-40deg) translateX(-600px);
    }
  }

  .slide-to-wall {
    transition: all 0.5s ease;
    z-index: 999;
  }

  </style>
</head>
<body>
<div id="game">
  <div id="score">0</div>

  <!-- Penalty Buttons -->
  <img class="penalty" id="p1" src="m1up.png" style="left:75px; top:278px">
  <img class="penalty" id="p2" src="s1up.png" style="left:113px; top:278px">
  <img class="penalty" id="p3" src="s2up.png" style="left:151px; top:278px">
  <img class="penalty" id="p4" src="s2up.png" style="left:189px; top:278px">
  <img class="penalty" id="p5" src="s2up.png" style="left:227px; top:278px">
  <img class="penalty" id="p6" src="s3up.png" style="left:265px; top:278px">
  <img class="penalty" id="p7" src="s3up.png" style="left:303px; top:278px">




  <!-- Player Rows - clickable tiles -->
  <div class="player-tile" id="r1c1" style="left:594px; top:101px;"></div>
  <div class="player-tile" id="r2c1" style="left:464px; top:232px;"></div>
  <div class="player-tile" id="r2c2" style="left:594px; top:232px;"></div>
  <div class="player-tile" id="r3c1" style="left:334px; top:363px;"></div>
  <div class="player-tile" id="r3c2" style="left:464px; top:363px;"></div>
  <div class="player-tile" id="r3c3" style="left:594px; top:363px;"></div>
  <div class="player-tile" id="r4c1" style="left:204px; top:494px;"></div>
  <div class="player-tile" id="r4c2" style="left:334px; top:494px;"></div>
  <div class="player-tile" id="r4c3" style="left:464px; top:494px;"></div>
  <div class="player-tile" id="r4c4" style="left:594px; top:494px;"></div>
  <div class="player-tile" id="r5c1" style="left:74px; top:625px;"></div>
  <div class="player-tile" id="r5c2" style="left:204px; top:625px;"></div>
  <div class="player-tile" id="r5c3" style="left:334px; top:625px;"></div>
  <div class="player-tile" id="r5c4" style="left:464px; top:625px;"></div>
  <div class="player-tile" id="r5c5" style="left:594px; top:625px;"></div>

  <!-- Popup -->
  <div id="popup"></div>
<!-- Wall Grid (placed tiles) -->
<div class="wall-tile" id="w0c0" style="left:789px; top:101px;"></div>
<div class="wall-tile" id="w0c1" style="left:917px; top:101px;"></div>
<div class="wall-tile" id="w0c2" style="left:1045px; top:101px;"></div>
<div class="wall-tile" id="w0c3" style="left:1173px; top:101px;"></div>
<div class="wall-tile" id="w0c4" style="left:1301px; top:101px;"></div>

<div class="wall-tile" id="w1c0" style="left:789px; top:232px;"></div>
<div class="wall-tile" id="w1c1" style="left:917px; top:232px;"></div>
<div class="wall-tile" id="w1c2" style="left:1045px; top:232px;"></div>
<div class="wall-tile" id="w1c3" style="left:1173px; top:232px;"></div>
<div class="wall-tile" id="w1c4" style="left:1301px; top:232px;"></div>

<div class="wall-tile" id="w2c0" style="left:789px; top:363px;"></div>
<div class="wall-tile" id="w2c1" style="left:917px; top:363px;"></div>
<div class="wall-tile" id="w2c2" style="left:1045px; top:363px;"></div>
<div class="wall-tile" id="w2c3" style="left:1173px; top:363px;"></div>
<div class="wall-tile" id="w2c4" style="left:1301px; top:363px;"></div>

<div class="wall-tile" id="w3c0" style="left:789px; top:494px;"></div>
<div class="wall-tile" id="w3c1" style="left:917px; top:494px;"></div>
<div class="wall-tile" id="w3c2" style="left:1045px; top:494px;"></div>
<div class="wall-tile" id="w3c3" style="left:1173px; top:494px;"></div>
<div class="wall-tile" id="w3c4" style="left:1301px; top:494px;"></div>

<div class="wall-tile" id="w4c0" style="left:789px; top:625px;"></div>
<div class="wall-tile" id="w4c1" style="left:917px; top:625px;"></div>
<div class="wall-tile" id="w4c2" style="left:1045px; top:625px;"></div>
<div class="wall-tile" id="w4c3" style="left:1173px; top:625px;"></div>
<div class="wall-tile" id="w4c4" style="left:1301px; top:625px;"></div>
</div>

  <!-- End Round Button -->
  <img id="end-round" src="endroundup.png"
     style="position: absolute; left: 76px; top: 350px; cursor: pointer;" 
     onmousedown="this.src='endrounddown.png'" 
     onmouseup="this.src='endroundup.png'" />

<!-- End Game Button -->
<img id="end-game" src="endgameup.png" 
     style="position: absolute; left: 76px; top: 410px; cursor: pointer;" 
     onmousedown="this.src='endgamedown.png'" 
     onmouseup="this.src='endgameup.png'" />

<!-- Confirm End Popup -->
<div id="confirm-end" style="display: none; position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%);
     width: 344px; height: 130px; background: url('areyousure.png') no-repeat center; background-size: cover;
     box-shadow: 0 8px 20px rgba(0,0,0,0.5); z-index: 1000;">
  <img id="confirm-yes" src="confirmup.png" style="position: absolute; bottom: 9px; left: 20px; width: 125px; height: 44px; cursor: pointer;"
       onmousedown="this.src='confirmdown.png'" onmouseup="this.src='confirmup.png'">
  <img id="confirm-no" src="notyetup.png" style="position: absolute; bottom: 9px; right: 20px; width: 125px; height: 44px; cursor: pointer;"
       onmousedown="this.src='notyetdown.png'" onmouseup="this.src='notyetup.png'">
</div>

<script>
const TILE_COLORS = ['blue', 'orange', 'red', 'black', 'aqua'];
const TILE_IMAGES = {
  blue: 'bluetile.png',
  orange: 'orangetile.png',
  red: 'redtile.png',
  black: 'blacktile.png',
  aqua: 'aquatile.png'
};

const finalWallColors = [
  ['blue', 'orange', 'red', 'black', 'aqua'],
  ['aqua', 'blue', 'orange', 'red', 'black'],
  ['black', 'aqua', 'blue', 'orange', 'red'],
  ['red', 'black', 'aqua', 'blue', 'orange'],
  ['orange', 'red', 'black', 'aqua', 'blue']
];

const wallState = Array.from({ length: 5 }, () => Array(5).fill(null));
const penaltySelected = Array(7).fill(false);
let currentScore = 0;

const popup = document.getElementById('popup');

function updateScoreDisplay() {
  const penaltyPoints = calculatePenaltyPoints();
  document.getElementById('score').textContent = currentScore - penaltyPoints;
}

document.querySelectorAll('.penalty').forEach((button, index) => {
  button.addEventListener('click', () => {
    penaltySelected[index] = !penaltySelected[index];
    button.src = penaltySelected[index] ? button.src.replace('up', 'down') : button.src.replace('down', 'up');
    updateScoreDisplay();
  });
});

function calculatePenaltyPoints() {
  let total = 0;
  penaltySelected.forEach((selected, i) => {
    if (selected) {
      if (i <= 1) total += 1;
      else if (i <= 4) total += 2;
      else total += 3;
    }
  });
  return total;
}

function getWallColumn(row, color) {
  return finalWallColors[row].indexOf(color);
}

function scorePlacement(row, col) {
  let horizontal = 1;
  let vertical = 1;

  let left = col - 1;
  while (left >= 0 && wallState[row][left]) {
    horizontal++;
    left--;
  }

  let right = col + 1;
  while (right < 5 && wallState[row][right]) {
    horizontal++;
    right++;
  }

  let up = row - 1;
  while (up >= 0 && wallState[up][col]) {
    vertical++;
    up--;
  }

  let down = row + 1;
  while (down < 5 && wallState[down][col]) {
    vertical++;
    down++;
  }

  if (horizontal > 1 && vertical > 1) return horizontal + vertical;
  if (horizontal > 1) return horizontal;
  if (vertical > 1) return vertical;
  return 1;
}

function openPopup(targetEl, rowIndex) {
  popup.innerHTML = '';
  popup.style.background = 'url(selectionbox.png) no-repeat center';
  popup.style.backgroundSize = 'contain';

  const rect = targetEl.getBoundingClientRect();
  popup.style.left = (rect.left + 60) + 'px';
  popup.style.top = (rect.top - 20) + 'px';

  TILE_COLORS.forEach(color => {
    const img = document.createElement('img');
    img.src = TILE_IMAGES[color];
    img.className = 'tile-option';
    img.addEventListener('click', () => {
      clearRow(rowIndex);
      targetEl.style.background = `url(${TILE_IMAGES[color]}) no-repeat center`;
      targetEl.style.backgroundSize = 'cover';
      targetEl.dataset.color = color;
      popup.style.display = 'none';
    });
    popup.appendChild(img);
  });

  const clearBtn = document.createElement('div');
  clearBtn.textContent = 'âœ•';
  clearBtn.style.cssText = 'width:48px;height:48px;line-height:48px;text-align:center;font-size:32px;cursor:pointer;background:#ccc;border-radius:6px;';
  clearBtn.addEventListener('click', () => {
    clearRow(rowIndex);
    targetEl.style.background = '';
    delete targetEl.dataset.color;
    popup.style.display = 'none';
  });
  popup.appendChild(clearBtn);
  popup.style.display = 'flex';
}

function clearRow(rowIndex) {
  const tiles = document.querySelectorAll(`.player-tile[id^=r${rowIndex + 1}]`);
  tiles.forEach(tile => {
    tile.style.background = '';
    delete tile.dataset.color;
  });
}

document.querySelectorAll('.player-tile').forEach(tile => {
  tile.addEventListener('click', () => {
    const row = parseInt(tile.id[1]) - 1;
    const col = parseInt(tile.id[3]) - 1;
    const leftTile = document.getElementById(`r${row + 1}c1`);
    const rowColor = leftTile.dataset.color;
    if (col === 0) {
      openPopup(tile, row);
    } else if (!tile.dataset.color && rowColor) {
      tile.style.background = `url(${TILE_IMAGES[rowColor]}) no-repeat center`;
      tile.style.backgroundSize = 'cover';
      tile.dataset.color = rowColor;
    }
  });
});

document.getElementById('end-round').addEventListener('click', () => {
  for (let row = 0; row < 5; row++) {
    const tiles = [];
    for (let col = 1; col <= row + 1; col++) {
      const tile = document.getElementById(`r${row + 1}c${col}`);
      if (!tile.dataset.color) break;
      tiles.push(tile);
    }

    if (tiles.length === row + 1) {
      const color = tiles[0].dataset.color;
      const wallCol = getWallColumn(row, color);
      const wallTile = document.getElementById(`w${row}c${wallCol}`);
      if (wallCol !== -1 && !wallState[row][wallCol] && wallTile) {
        wallState[row][wallCol] = color;
        const rectStart = tiles[tiles.length - 1].getBoundingClientRect();
        const rectEnd = wallTile.getBoundingClientRect();
        const gameRect = document.getElementById('game').getBoundingClientRect();
        const clone = tiles[tiles.length - 1].cloneNode(true);
        clone.classList.add('slide-to-wall');
        clone.style.position = 'absolute';
        clone.style.left = (rectStart.left - gameRect.left) + 'px';
        clone.style.top = (rectStart.top - gameRect.top) + 'px';
        clone.style.background = `url(${TILE_IMAGES[color]}) no-repeat center`;
        clone.style.backgroundSize = 'cover';
        document.getElementById('game').appendChild(clone);
        requestAnimationFrame(() => {
          clone.style.left = (rectEnd.left - gameRect.left) + 'px';
          clone.style.top = (rectEnd.top - gameRect.top) + 'px';
        });
        setTimeout(() => {
          clone.remove();
          wallTile.style.background = `url(${TILE_IMAGES[color]}) no-repeat center`;
          wallTile.style.backgroundSize = 'cover';
        }, 600);
        currentScore += scorePlacement(row, wallCol);
      }

      tiles.forEach(tile => {
        tile.classList.add('fly-left');
        setTimeout(() => {
          tile.style.background = '';
          delete tile.dataset.color;
          tile.classList.remove('fly-left');
        }, 600);
      });

      setTimeout(() => {
        const leftTile = document.getElementById(`r${row + 1}c1`);
        delete leftTile.dataset.color;
        leftTile.style.background = '';
      }, 600);
    }
  }

  // Handle penalty here
  const penalties = calculatePenaltyPoints();
  currentScore -= penalties;
  penaltySelected.fill(false);
  document.querySelectorAll('.penalty').forEach(btn => btn.src = btn.src.replace('down', 'up'));

  setTimeout(updateScoreDisplay, 650);
});

document.addEventListener('click', (e) => {
  if (!e.target.closest('.tile-option') && !e.target.classList.contains('player-tile')) {
    popup.style.display = 'none';
  }
});
document.getElementById('end-game').addEventListener('click', () => {
  document.getElementById('confirm-end').style.display = 'block';
});

document.getElementById('confirm-no').addEventListener('click', () => {
  document.getElementById('confirm-end').style.display = 'none';
});

// Optional: wire up confirm-yes to do something
document.getElementById('confirm-yes').addEventListener('click', () => {
  // You could add logic here to reset the game or go to a new screen
  alert('Game Over! Final score: ' + (currentScore - calculatePenaltyPoints()));
  document.getElementById('confirm-end').style.display = 'none';
});
</script>


</body>
</html>
